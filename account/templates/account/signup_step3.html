<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- ÙÙˆÙ†Øª ÙˆØ²ÛŒØ± Ù…ØªÛŒÙ† -->
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #181848 0%, #2176ae 100%);
        font-family: "Vazirmatn", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .glass-box {
        background: rgba(20, 31, 44, 0.85);
        box-shadow: 0 0 40px 2px rgba(29, 45, 68, 0.3);
        border-radius: 26px;
        padding: 36px 34px;
        max-width: 410px;
        width: 100%;
        backdrop-filter: blur(10px);
      }
      .glass-box h2 {
        color: #fff;
        text-align: center;
        margin-bottom: 28px;
        letter-spacing: 1px;
        font-weight: 700;
      }
      label {
        color: #c2dbff;
        margin-bottom: 4px;
        font-size: 0.95rem;
        display: block;
      }
      input,
      select {
        background: rgba(43, 60, 87, 0.8);
        color: #fff;
        border: none;
        border-radius: 10px;
        width: 100%;
        padding: 9px 13px;
        margin-bottom: 14px;
        font-size: 1rem;
        outline: none;
        transition: box-shadow 0.2s;
      }
      input:focus,
      select:focus {
        box-shadow: 0 0 0 2px #3496ff;
      }
      button {
        width: 100%;
        padding: 12px 0;
        background: linear-gradient(90deg, #3a8dde, #1c2e57);
        color: #fff;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1.12rem;
        box-shadow: 0 8px 28px -8px #3574b3a8;
        margin-top: 7px;
        transition: background 0.2s;
      }
      button:active {
        background: linear-gradient(90deg, #20568f, #1c2e57);
      }
      .status {
        margin: 18px 0 3px 0;
        min-height: 24px;
        font-size: 1rem;
        font-weight: 500;
        text-align: center;
      }
      ::placeholder {
        color: #abc6e8a1;
      }
    </style>
  </head>
  <body>
    <form class="glass-box" id="profile-form" autocomplete="off">
      <h2>ØªÚ©Ù…ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</h2>
      <div class="status" id="status"></div>
      <label for="full_name">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
      <input
        type="text"
        id="full_name"
        name="full_name"
        required
        autofocus
        placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø§Ú©Ø¨Ø±ÛŒ"
      />

      <label for="national_id">Ú©Ø¯ Ù…Ù„ÛŒ</label>
      <input
        type="text"
        id="national_id"
        name="national_id"
        required
        maxlength="10"
        placeholder="Ù…Ø«Ø§Ù„: Û°Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸"
      />

      <label for="birth_date">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯</label>
      <input type="date" id="birth_date" name="birth_date" required />

      <label for="previous_school">Ù…Ø¯Ø±Ø³Ù‡ Ù‚Ø¨Ù„ÛŒ</label>
      <input
        type="text"
        id="previous_school"
        name="previous_school"
        required
        placeholder="Ù†Ø§Ù… Ù…Ø¯Ø±Ø³Ù‡ Ù‚Ø¨Ù„ÛŒ"
      />

      <label for="last_year_gpa">Ù…Ø¹Ø¯Ù„ Ø³Ø§Ù„ Ù‚Ø¨Ù„</label>
      <input
        type="text"
        id="last_year_gpa"
        name="last_year_gpa"
        required
        maxlength="5"
        placeholder="Ù…Ø«Ø§Ù„: Û±Û¹.Û²Ûµ"
      />

      <hr style="border-color: #33518066; margin: 16px 0 12px 0" />

      <label for="father_name">Ù†Ø§Ù… Ù¾Ø¯Ø±</label>
      <input
        type="text"
        id="father_name"
        name="father_name"
        required
        placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø§Ú©Ø¨Ø±ÛŒ"
      />

      <label for="father_job">Ø´ØºÙ„ Ù¾Ø¯Ø±</label>
      <input type="text" id="father_job" name="father_job" required />

      <label for="father_education">Ù…Ø¯Ø±Ú© ØªØ­ØµÛŒÙ„ÛŒ Ù¾Ø¯Ø±</label>
      <input
        type="text"
        id="father_education"
        name="father_education"
        required
      />

      <label for="mother_name">Ù†Ø§Ù… Ù…Ø§Ø¯Ø±</label>
      <input type="text" id="mother_name" name="mother_name" required />

      <label for="mother_job">Ø´ØºÙ„ Ù…Ø§Ø¯Ø±</label>
      <input type="text" id="mother_job" name="mother_job" required />

      <label for="mother_education">Ù…Ø¯Ø±Ú© ØªØ­ØµÛŒÙ„ÛŒ Ù…Ø§Ø¯Ø±</label>
      <input
        type="text"
        id="mother_education"
        name="mother_education"
        required
      />

      <label for="mother_mobile">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø§Ø¯Ø±</label>
      <input
        type="text"
        id="mother_mobile"
        name="mother_mobile"
        required
        maxlength="11"
        placeholder="Ù…Ø«Ø§Ù„: Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"
      />

      <button type="submit" id="submit-btn">Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
    </form>

    <script>
      // Helper for CSRF
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      const form = document.getElementById("profile-form");
      const status = document.getElementById("status");
      const btn = document.getElementById("submit-btn");

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        status.textContent = "";
        btn.disabled = true;

        // Gather form data
        const formData = new FormData(form);
        const data = {};
        formData.forEach((v, k) => (data[k] = v));

        fetch("/api/register/complete-profile/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"),
          },
          body: JSON.stringify(data),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              status.style.color = "#8fffbd";
              status.textContent = "ğŸ‘‘ Ø«Ø¨Øª Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²! Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ ...";
              setTimeout(() => {
                window.location.href = "/dashboard/";
              }, 1050);
            } else {
              status.style.color = "#ffb3b3";
              status.textContent =
                data.error || data.msg || "Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.";
            }
          })
          .catch((err) => {
            status.style.color = "#ffb3b3";
            status.textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±.";
          })
          .finally(() => {
            btn.disabled = false;
          });
      });
    </script>
  </body>
</html>
